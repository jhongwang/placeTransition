function initPage(t,e){MapHelper.install(document.getElementById("root"),{lat:e,lng:t,onPoiChange:function(t,e){p=0;$$("radius").value;MapHelper.setMarkerPostion(e,t),$("#search_lng_lat").val(""+t+":"+e)}})}function cur_city_code(t){$.ajax({type:"get",url:"http://apis.map.qq.com/ws/geocoder/v1/?address="+t+"&key=WC4BZ-TFI24-M45UM-DI57V-SVUH3-LQFUV&output=jsonp&time="+(new Date).getTime(),dataType:"jsonp",jsonp:"cb",jsonpCallback:"citylogin1",success:function(t){if(0==t.status){var e=t.result.location.lat,i=t.result.location.lng;poi_list(i,e,500)}},error:function(t){console.log("fail-getReact")},beforeSend:function(){},complete:function(){}})}function cur_city_get(t,e){$.ajax({type:"get",url:"http://apis.map.qq.com/ws/geocoder/v1/?location="+t+","+e+"&key=WC4BZ-TFI24-M45UM-DI57V-SVUH3-LQFUV&output=jsonp&qtime="+(new Date).getTime(),dataType:"jsonp",jsonp:"callback",jsonpCallback:"curCity",success:function(t){0==t.status&&t.result&&t.result.address_component&&t.result.address_component.city&&(cur_city=t.result.ad_info.city,cur_code=t.result.ad_info.adcode,cur_city_code_(cur_city),"北京市"==cur_city||"天津市"==cur_city||"上海市"==cur_city||"重庆市"==cur_city||"台湾"==cur_city||"香港特别行政区"==cur_city||"澳门特别行政区"==cur_city?(cur_code=String(cur_code).substr(0,2)+"0000",cur_code=Number(cur_code)):(cur_code=String(cur_code).substr(0,4)+"00",cur_code=Number(cur_code)),$("#city_login").val(cur_city))},error:function(t){console.log("fail_cur_city_get")},beforeSend:function(){},complete:function(){}})}function draw_poi_daoguan(t,e){MapHelper.setMarkers_poi(t,e)}function draw_poi_bujizhan(t,e){MapHelper.setMarkers_poi_radio(t,e)}function $$(t){return document.getElementById(t)}function clearDitu(){MapHelper.cleanInfo(),MapHelper.cleanMarker(),MapHelper.cleanPoi(),MapHelper.cleanRect(),MapHelper.cleanInfo(),MapHelper.cleanMarkers_poi(),MapHelper.cleanMarkers_poi_radio(),MapHelper.cleanMarkers_poi_guai()}function GetQueryString(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),i=window.location.search.substr(1).match(e);return null!=i?i[2]:null}function GetRequest(){var t=location.hash,e=new Object;if(t.indexOf("#")!=-1){var i=t.substr(1);strs=i.split("&");for(var a=0;a<strs.length;a++)e[strs[a].split("=")[0]]=unescape(strs[a].split("=")[1])}return e}function poi_list(t,e,i){clearDitu(),arr_bujizhan=[],arr_daoguan=[],other_arr=[],$("#ajax_tip").css("display","none"),cur_city_get(e,t);var a={},o={},s={},n=$("#banben_sel").val();n=n.replace(/\s/g,""),$.ajax({type:"get",url:"http://10.173.142.164:8080/poke_timi_200916/php/get_frag_info_timi.php?point_x="+t+"&point_y="+e+"&radius="+i+"&key="+key+"&output_type=jsonp&cb=ajaxpoilist&time="+(new Date).getTime()+"&ref=timi_version",dataType:"jsonp",jsonp:"cb",jsonpCallback:"test",success:function(n){if(n.key&&n.key!=-1)if($("#ajax_before_tip").css("display","none"),n.gyms_list&&n.pokestops_list&&n.frag_list){jQuery.extend(!0,a,n),jQuery.extend(!0,o,n),jQuery.extend(!0,s,n),MapHelper.setCenter(e,t),MapHelper.setMarker(e,t);for(var r=0;r<tuli_title.length;r++)tuli_title[r].num=0;arr_bujizhan=o.pokestops_list,arr_daoguan=a.gyms_list,arr_guai=s.spawns_list,ditubiaoji_d=a.gyms_list,ditubiaoji_b=o.pokestops_list,ditubiaoji_g=s.spawns_list,other_arr=a.frag_list,otherInfo(other_arr),drawRs(other_arr),zuixin_daoguan_arr=a.gyms_list,zuixin_buji_arr=o.pokestops_list,zuixin_guai_arr=s.spawns_list,poi_list_show(zuixin_daoguan_arr,zuixin_buji_arr,zuixin_guai_arr)}else $("#ajax_tip").css("display","block"),MapHelper.cleanPoi();else poi_list_wuquan(t,e,i)},error:function(t){console.log("fail_poi_latlng")},beforeSend:function(){$("#ajax_before_tip").css("display","block")},complete:function(){window.location.hash="point_x="+t+"&point_y="+e+"&radius="+$$("radius").value}})}function poi_search_wenzi(t,e){$.ajax({type:"get",asycn:!1,url:"http://apis.map.qq.com/ws/place/v1/search?boundary=region("+cur_city+",1)",data:{keyword:t,key:"WC4BZ-TFI24-M45UM-DI57V-SVUH3-LQFUV",page_size:1,page_index:1,output:"jsonp"},chche:!1,dataType:"jsonp",jsonp:"cb",jsonpCallback:"search_result",success:function(t){if(t&&t.data&&t.data[0]&&t.data[0].location&&t.data[0].location.lat&&t.data[0].location.lng&&t.data[0].title){t.data[0].location.lat,t.data[0].location.lng;$("#search_lng_lat").val(t.data[0].title)}else alert("抱歉,搜索结果为空！")},error:function(){console.log("fail_poi_search_wenzi")},beforeSend:function(){},complete:function(){}})}function imgShow(t){var e='<img width="300" height="500" src="http://svpoi.wsd.com/poi_image/shenzhen/'+t+'_gl.jpg" onerror="nofind();"/>';TINY.box.show(e,0,0,0,1)}function nofind(){var t=event.srcElement;t.src="images/nofind.jpg",t.onerror=null}function AutoComplete(t,e,i){this.obj=$$$$(t),this.autoObj=$$$$(e),this.value_arr=i,this.index=-1,this.search_value=""}$(function(){var t=$("#nav").width();$("#root").css("margin-right",t+72+"px"),initPage(116.31649,39.98389);var e=window.location.hash;if(""==e);else{var i=GetRequest(),a=i.point_x,o=i.point_y;$("#search_lng_lat").val(""+a+":"+o)}$("#poi_search").click(function(){$("#ui-id-1").css("display","none");var t=$("#search_lng_lat").val(),e=$("#radius").val();e=e.replace(/\s/g,""),t=t.replace(/\s/g,"");var i=t.indexOf(","),a=t.indexOf(":");if(a==-1&&i==-1)poi_search_wenzi(t,e);else{var o;t.indexOf(",")!==-1&&(o=t.split(",")),t.indexOf(":")!==-1&&(o=t.split(":"));var s=o[1],n=o[0];poi_list(n,s,e)}}),$("#search_lng_lat").click(function(){$(this).select()}),$(".input_btn").mousedown(function(){$(this).css("background","#3b83c0")}),$(".input_btn").mouseup(function(){$(this).css("background","#2d9cff")}),$("#ui-id-1 li").click(function(){var t=$(this).html(),e=t.split("<")[0];e=e.replace(/\s/g,""),$("#search_lng_lat").val(e),$("#ui-id-1").css("display","none");var i=$(this).find("em").html(),a=i.split(",")[0],o=i.split(",")[1],s=$("#radius").val();s=s.replace(/\s/g,""),poi_list(o,a,s)}),$("#ui-id-1 li").mouseover(function(){$(this).addClass("autoli_cur").siblings().removeClass("autoli_cur"),ui_id_li_curNum=$(this).index()});var s="北京";$("#search_lng_lat").autocomplete({minLength:0,source:function(t,e){if(""!=$("#search_lng_lat").val()){$("#ui-id-1").css("display","block");var i=$("#search_lng_lat").val();$.ajax({type:"get",async:!1,url:"http://apis.map.qq.com/ws/place/v1/search?boundary=region("+s+",1)",data:{keyword:i,key:"WC4BZ-TFI24-M45UM-DI57V-SVUH3-LQFUV",output:"jsonp"},cache:!1,dataType:"jsonp",jsonp:"cb",jsonpCallback:"auto",success:function(t){if(t&&t.data&&t.data!=[])for(var e=t.data,i=0;i<e.length;i++){$("#ui-id-1 li").eq(i).attr("class",""),$("#ui-id-1 li").eq(i).addClass(e[i].id);var a=e[i].title,o=e[i].category.split(":").pop(),s=e[i].ad_info.province+"-"+e[i].ad_info.city+"-"+e[i].ad_info.district;$("#ui-id-1 li").eq(i).html(""+a+"<span>&nbsp;【"+o+"】</span><span>【"+s+"】</span><em>"+e[i].location.lat+","+e[i].location.lng+"</em>")}},error:function(t){console.log("请检查suggestion")},complete:function(){}})}else $("#ui-id-1").css("display","none")}}),document.onkeydown=function(t){t||(t=window.event),13==(t.keyCode||t.which)}}),jQuery.ajaxSetup({timeout:2e4,cache:!1});var poi_category={0:"普通POI",1:"公交车站",2:"地铁站",3:"公交路线",4:"行政区划"},$$$$=function(t){return"string"==typeof t?document.getElementById(t):t},Bind=function(t,e){return function(){return e.apply(t,arguments)}};AutoComplete.prototype={init:function(){this.autoObj.style.left=this.obj.offsetLeft+"px",this.autoObj.style.top=this.obj.offsetTop+this.obj.offsetHeight+"px",this.autoObj.style.width=this.obj.offsetWidth-2+"px"},deleteDIV:function(){for(;this.autoObj.hasChildNodes();)this.autoObj.removeChild(this.autoObj.firstChild);this.autoObj.className="auto_hidden"},setValue:function(t){return function(){t.obj.value=this.seq,t.autoObj.className="auto_hidden"}},autoOnmouseover:function(t,e){return function(){t.index=e;for(var i=t.autoObj.children.length,a=0;a<i;a++)a!=t.index?t.autoObj.childNodes[a].className="auto_onmouseout":t.autoObj.childNodes[a].className="auto_onmouseover"}},changeClassname:function(t){for(var e=0;e<t;e++)e!=this.index?this.autoObj.childNodes[e].className="auto_onmouseout":(this.autoObj.childNodes[e].className="auto_onmouseover",this.obj.value=this.autoObj.childNodes[e].seq)},pressKey:function(t){var e=this.autoObj.children.length;40==t.keyCode?(++this.index,this.index>e?this.index=0:this.index==e&&(this.obj.value=this.search_value),this.changeClassname(e)):38==t.keyCode?(this.index--,this.index<-1?this.index=e-1:this.index==-1&&(this.obj.value=this.search_value),this.changeClassname(e)):13==t.keyCode?(this.autoObj.className="auto_hidden",this.index=-1):this.index=-1},start:function(t){if(13!=t.keyCode&&38!=t.keyCode&&40!=t.keyCode){this.init(),this.deleteDIV(),this.search_value=this.obj.value;var e=this.value_arr;if(""==this.obj.value.replace(/(^\s*)|(\s*$)/g,""))return;try{var i=new RegExp("("+this.obj.value+")","i")}catch(t){return}for(var a=0,o=0;o<e.length;o++)if(i.test(e[o].title)){var s=document.createElement("div");addClass(s,e[o].id),addClass(s,"auto_onmouseout"),s.seq=e[o].title,s.onclick=this.setValue(this),s.onmouseover=this.autoOnmouseover(this,a);var n="无",r=""+e[o].title+"<"+e[o].province+"-"+e[o].city+"-"+(e[o].district?e[o].district:n)+">";s.innerHTML=r.replace(i,"<strong>$1</strong>"),this.autoObj.appendChild(s),this.autoObj.className="auto_show",a++}}this.pressKey(t),window.onresize=Bind(this,function(){this.init()})}};