function initPage(e,t){MapHelper.install(document.getElementById("root"),{lat:t,lng:e,onPoiChange:function(e,t){p=0;$$("radius").value;MapHelper.setMarkerPostion(t,e),$("#search_lng_lat").val(""+e+":"+t)}})}function cur_city_get(e,t){$.ajax({type:"get",url:"http://apis.map.qq.com/ws/geocoder/v1/?location="+e+","+t+"&key=WC4BZ-TFI24-M45UM-DI57V-SVUH3-LQFUV&output=jsonp&qtime="+(new Date).getTime(),dataType:"jsonp",jsonp:"callback",jsonpCallback:"curCity",success:function(e){0==e.status&&e.result&&e.result.address_component&&e.result.address_component.city&&(cur_city=e.result.ad_info.city,cur_code=e.result.ad_info.adcode,cur_city_code_(cur_city),"北京市"==cur_city||"天津市"==cur_city||"上海市"==cur_city||"重庆市"==cur_city||"台湾"==cur_city||"香港特别行政区"==cur_city||"澳门特别行政区"==cur_city?(cur_code=String(cur_code).substr(0,2)+"0000",cur_code=Number(cur_code)):(cur_code=String(cur_code).substr(0,4)+"00",cur_code=Number(cur_code)),$("#city_login").val(cur_city))},error:function(e){console.log("fail_cur_city_get")},beforeSend:function(){},complete:function(){}})}function draw_poi_daoguan(e,t){MapHelper.setMarkers_poi(e,t)}function draw_poi_bujizhan(e,t){MapHelper.setMarkers_poi_radio(e,t)}function $$(e){return document.getElementById(e)}function clearDitu(){MapHelper.cleanInfo(),MapHelper.cleanMarker(),MapHelper.cleanPoi(),MapHelper.cleanRect(),MapHelper.cleanInfo(),MapHelper.cleanMarkers_poi()}function GetQueryString(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),i=window.location.search.substr(1).match(t);return null!=i?i[2]:null}function GetRequest(){var e=location.hash,t=new Object;if(e.indexOf("#")!=-1){var i=e.substr(1);strs=i.split("&");for(var s=0;s<strs.length;s++)t[strs[s].split("=")[0]]=unescape(strs[s].split("=")[1])}return t}function poi_list(e,t,i){clearDitu(),arr_bujizhan=[],arr_daoguan=[],other_arr=[],$("#ajax_tip").css("display","none"),cur_city_get(t,e);var s={},a={},o={},n=$("#banben_sel").val();n=n.replace(/\s/g,""),$.ajax({type:"get",url:"http://10.173.142.164:8080/poke_timi_200916/php/get_frag_info_timi.php?point_x="+e+"&point_y="+t+"&radius="+i+"&key="+key+"&output_type=jsonp&cb=ajaxpoilist&time="+(new Date).getTime()+"&ref=timi_version",dataType:"jsonp",jsonp:"cb",jsonpCallback:"test",success:function(n){if(n.key&&n.key!=-1)if($("#ajax_before_tip").css("display","none"),n.gyms_list&&n.pokestops_list&&n.frag_list){jQuery.extend(!0,s,n),jQuery.extend(!0,a,n),jQuery.extend(!0,o,n),MapHelper.setCenter(t,e),MapHelper.setMarker(t,e);for(var c=0;c<tuli_title.length;c++)tuli_title[c].num=0;arr_bujizhan=a.pokestops_list,arr_daoguan=s.gyms_list,arr_guai=o.spawns_list,ditubiaoji_d=s.gyms_list,ditubiaoji_b=a.pokestops_list,ditubiaoji_g=o.spawns_list,other_arr=s.frag_list,otherInfo(other_arr),drawRs(other_arr),zuixin_daoguan_arr=s.gyms_list,zuixin_buji_arr=a.pokestops_list,zuixin_guai_arr=o.spawns_list,poi_list_show(zuixin_daoguan_arr,zuixin_buji_arr,zuixin_guai_arr)}else $("#ajax_tip").css("display","block"),MapHelper.cleanPoi();else poi_list_wuquan(e,t,i)},error:function(e){console.log("fail_poi_latlng")},beforeSend:function(){$("#ajax_before_tip").css("display","block")},complete:function(){window.location.hash="point_x="+e+"&point_y="+t+"&radius="+$$("radius").value}})}function poi_search_wenzi(e){$.ajax({type:"get",asycn:!1,url:"http://apis.map.qq.com/ws/place/v1/search?boundary=region("+cur_city+",1)",data:{keyword:e,key:"WC4BZ-TFI24-M45UM-DI57V-SVUH3-LQFUV",page_size:1,page_index:1,output:"jsonp"},chche:!1,dataType:"jsonp",jsonp:"cb",jsonpCallback:"search_result",success:function(e){e?console.log(e):alert("抱歉,搜索结果为空！")},error:function(){console.log("fail_poi_search_wenzi")},beforeSend:function(){},complete:function(){}})}function AutoComplete(e,t,i){this.obj=$$$$(e),this.autoObj=$$$$(t),this.value_arr=i,this.index=-1,this.search_value=""}$(function(){var e=$("#nav").width();$("#root").css("margin-right",e+72+"px"),initPage(116.31649,39.98389);var t=window.location.hash;if(""==t);else{var i=GetRequest(),s=i.point_x,a=i.point_y;$("#search_lng_lat").val(""+s+":"+a)}$("#poi_search").click(function(){$("#ui-id-1").css("display","none");var e=$("#search_lng_lat").val();e=e.replace(/\s/g,"");var t=e.indexOf(","),i=e.indexOf(":");if(i==-1&&t==-1)poi_search_wenzi(e);else{var s;e.indexOf(",")!==-1&&(s=e.split(",")),e.indexOf(":")!==-1&&(s=e.split(":"));s[1],s[0]}}),$("#search_lng_lat").click(function(){$(this).select()}),$(".input_btn").mousedown(function(){$(this).css("background","#3b83c0")}),$(".input_btn").mouseup(function(){$(this).css("background","#2d9cff")}),$("#ui-id-1 li").click(function(){var e=$(this).html(),t=e.split("<")[0];t=t.replace(/\s/g,""),$("#search_lng_lat").val(t),$("#ui-id-1").css("display","none");var i=$(this).find("em").html();i.split(",")[0],i.split(",")[1]}),$("#ui-id-1 li").mouseover(function(){$(this).addClass("autoli_cur").siblings().removeClass("autoli_cur"),ui_id_li_curNum=$(this).index()}),$('input[name="input_checkbox"]').click(function(){checkbox_selected=[],$('input[name="input_checkbox"]').each(function(e){$(this).context.checked&&checkbox_selected.push($(this).context.value)}),console.log(checkbox_selected)}),$("#search_lng_lat").autocomplete({minLength:0,source:function(e,t){if(""!=$("#search_lng_lat").val()){$("#ui-id-1").css("display","block");var i=$("#search_lng_lat").val();$.ajax({type:"get",async:!1,url:"http://apis.map.qq.com/ws/place/v1/search?boundary=region("+cur_city+",1)",data:{keyword:i,key:"WC4BZ-TFI24-M45UM-DI57V-SVUH3-LQFUV",output:"jsonp"},cache:!1,dataType:"jsonp",jsonp:"cb",jsonpCallback:"auto",success:function(e){if(e&&e.data&&e.data!=[])for(var t=e.data,i=0;i<t.length;i++){$("#ui-id-1 li").eq(i).attr("class",""),$("#ui-id-1 li").eq(i).addClass(t[i].id);var s=t[i].title,a=t[i].category.split(":").pop(),o=t[i].ad_info.province+"-"+t[i].ad_info.city+"-"+t[i].ad_info.district;$("#ui-id-1 li").eq(i).html(""+s+"<span>&nbsp;【"+a+"】</span><span>【"+o+"】</span><em>"+t[i].location.lat+","+t[i].location.lng+"</em>")}},error:function(e){console.log("请检查suggestion")},complete:function(){}})}else $("#ui-id-1").css("display","none")}}),document.onkeydown=function(e){e||(e=window.event),13==(e.keyCode||e.which)}}),jQuery.ajaxSetup({timeout:2e4,cache:!1});var checkbox_selected,cur_city="北京",$$$$=function(e){return"string"==typeof e?document.getElementById(e):e},Bind=function(e,t){return function(){return t.apply(e,arguments)}};AutoComplete.prototype={init:function(){this.autoObj.style.left=this.obj.offsetLeft+"px",this.autoObj.style.top=this.obj.offsetTop+this.obj.offsetHeight+"px",this.autoObj.style.width=this.obj.offsetWidth-2+"px"},deleteDIV:function(){for(;this.autoObj.hasChildNodes();)this.autoObj.removeChild(this.autoObj.firstChild);this.autoObj.className="auto_hidden"},setValue:function(e){return function(){e.obj.value=this.seq,e.autoObj.className="auto_hidden"}},autoOnmouseover:function(e,t){return function(){e.index=t;for(var i=e.autoObj.children.length,s=0;s<i;s++)s!=e.index?e.autoObj.childNodes[s].className="auto_onmouseout":e.autoObj.childNodes[s].className="auto_onmouseover"}},changeClassname:function(e){for(var t=0;t<e;t++)t!=this.index?this.autoObj.childNodes[t].className="auto_onmouseout":(this.autoObj.childNodes[t].className="auto_onmouseover",this.obj.value=this.autoObj.childNodes[t].seq)},pressKey:function(e){var t=this.autoObj.children.length;40==e.keyCode?(++this.index,this.index>t?this.index=0:this.index==t&&(this.obj.value=this.search_value),this.changeClassname(t)):38==e.keyCode?(this.index--,this.index<-1?this.index=t-1:this.index==-1&&(this.obj.value=this.search_value),this.changeClassname(t)):13==e.keyCode?(this.autoObj.className="auto_hidden",this.index=-1):this.index=-1},start:function(e){if(13!=e.keyCode&&38!=e.keyCode&&40!=e.keyCode){this.init(),this.deleteDIV(),this.search_value=this.obj.value;var t=this.value_arr;if(""==this.obj.value.replace(/(^\s*)|(\s*$)/g,""))return;try{var i=new RegExp("("+this.obj.value+")","i")}catch(e){return}for(var s=0,a=0;a<t.length;a++)if(i.test(t[a].title)){var o=document.createElement("div");addClass(o,t[a].id),addClass(o,"auto_onmouseout"),o.seq=t[a].title,o.onclick=this.setValue(this),o.onmouseover=this.autoOnmouseover(this,s);var n="无",c=""+t[a].title+"<"+t[a].province+"-"+t[a].city+"-"+(t[a].district?t[a].district:n)+">";o.innerHTML=c.replace(i,"<strong>$1</strong>"),this.autoObj.appendChild(o),this.autoObj.className="auto_show",s++}}this.pressKey(e),window.onresize=Bind(this,function(){this.init()})}};